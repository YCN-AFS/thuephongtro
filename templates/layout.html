<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}BienHoa Rentals - Tìm Nhà Thuê Hoàn Hảo{% endblock %}</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/custom.css') }}">
    
    <!-- Favicon -->
    <link rel="shortcut icon" href="{{ url_for('static', filename='img/favicon.ico') }}" type="image/x-icon">
    
    {% block extra_css %}{% endblock %}
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-light sticky-top">
        <div class="container">
            <a class="navbar-brand" href="{{ url_for('index') }}">
                <i class="fas fa-home"></i> BienHoa <span class="text-primary">Rentals</span>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link {% if request.path == url_for('index') %}active{% endif %}" href="{{ url_for('index') }}">
                            <i class="fas fa-home me-1 d-none d-lg-inline-block"></i>Trang Chủ
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link {% if request.path == url_for('search') %}active{% endif %}" href="{{ url_for('search') }}">
                            <i class="fas fa-search me-1 d-none d-lg-inline-block"></i>Tìm Kiếm
                        </a>
                    </li>
                    {% if user.is_authenticated %}
                        {% if user.user_type == 'landlord' %}
                            <li class="nav-item">
                                <a class="nav-link {% if request.path == url_for('landlord_dashboard') %}active{% endif %}" href="{{ url_for('landlord_dashboard') }}">
                                    <i class="fas fa-tachometer-alt me-1 d-none d-lg-inline-block"></i>Bảng Điều Khiển
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link {% if request.path == url_for('create_property') %}active{% endif %}" href="{{ url_for('create_property') }}">
                                    <i class="fas fa-plus-circle me-1 d-none d-lg-inline-block"></i>Đăng Tin
                                </a>
                            </li>
                        {% endif %}
                    {% endif %}
                </ul>
                <ul class="navbar-nav ms-auto">
                    {% if user.is_authenticated %}
                        <li class="nav-item me-2 d-none d-lg-block">
                            <button onclick="window.aiChat.openChat()" class="btn btn-outline-primary btn-sm mt-1" title="Trò chuyện với trợ lý AI">
                                <i class="fas fa-robot me-1"></i>Trợ Lý AI
                            </button>
                        </li>
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle d-flex align-items-center" href="#" id="userDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                                {% if user.profile_image_url %}
                                    <img src="{{ user.profile_image_url }}" alt="{{ user.first_name or 'User' }}" class="user-avatar me-2">
                                {% else %}
                                    <i class="fas fa-user-circle me-2 fs-5"></i>
                                {% endif %}
                                <span>{{ user.first_name or 'Người dùng' }}</span>
                            </a>
                            <ul class="dropdown-menu dropdown-menu-end shadow-sm">
                                <li>
                                    <a class="dropdown-item" href="{{ url_for('profile') }}">
                                        <i class="fas fa-user me-2 text-primary"></i>Hồ Sơ Cá Nhân
                                    </a>
                                </li>
                                {% if user.user_type != 'landlord' %}
                                    <li>
                                        <a class="dropdown-item" href="{{ url_for('landlord_dashboard') }}">
                                            <i class="fas fa-house-user me-2 text-primary"></i>Trở Thành Chủ Nhà
                                        </a>
                                    </li>
                                {% endif %}
                                {% if user.user_type == 'admin' %}
                                    <li><hr class="dropdown-divider"></li>
                                    <li>
                                        <a class="dropdown-item" href="{{ url_for('admin_dashboard') }}">
                                            <i class="fas fa-cogs me-2 text-primary"></i>Quản Trị Hệ Thống
                                        </a>
                                    </li>
                                {% endif %}
                                <li><hr class="dropdown-divider"></li>
                                <li>
                                    <a class="dropdown-item" href="{{ url_for('replit_auth.logout') }}">
                                        <i class="fas fa-sign-out-alt me-2 text-danger"></i>Đăng Xuất
                                    </a>
                                </li>
                            </ul>
                        </li>
                    {% else %}
                        <li class="nav-item d-none d-lg-block me-2">
                            <button onclick="window.aiChat.openChat()" class="btn btn-outline-primary btn-sm mt-1" title="Trò chuyện với trợ lý AI">
                                <i class="fas fa-robot me-1"></i>Trợ Lý AI
                            </button>
                        </li>
                        <li class="nav-item me-2">
                            <a class="btn btn-primary" href="{{ url_for('replit_auth.login') }}">
                                <i class="fas fa-sign-in-alt me-1"></i>Đăng Nhập
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="btn btn-outline-secondary" href="{{ url_for('google_auth.login') }}">
                                <i class="fab fa-google me-1"></i> Google
                            </a>
                        </li>
                    {% endif %}
                </ul>
            </div>
        </div>
    </nav>

    <!-- Flash Messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <div class="toast-container">
                {% for category, message in messages %}
                    <div class="toast flash-message" role="alert" aria-live="assertive" aria-atomic="true">
                        <div class="toast-header bg-{{ category if category != 'message' else 'info' }} text-white">
                            <strong class="me-auto">{{ 'Success' if category == 'success' else 'Error' if category == 'danger' else 'Info' }}</strong>
                            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="toast" aria-label="Close"></button>
                        </div>
                        <div class="toast-body">
                            {{ message }}
                        </div>
                    </div>
                {% endfor %}
            </div>
        {% endif %}
    {% endwith %}

    <!-- Main Content -->
    {% block content %}{% endblock %}

    <!-- Enhanced Footer -->
    <footer>
        <div class="container py-5">
            <div class="row gy-4">
                <div class="col-lg-4 col-md-6">
                    <h5>BienHoa <span class="text-primary">Rentals</span></h5>
                    <p class="mt-3">Tìm kiếm căn nhà cho thuê hoàn hảo tại Biên Hòa, Đồng Nai, Việt Nam. Chúng tôi kết nối chủ nhà và người thuê nhà một cách đơn giản và hiệu quả.</p>
                    <div class="social-icons d-flex mt-4">
                        <a href="#" class="social-icon me-2"><i class="fab fa-facebook-f"></i></a>
                        <a href="#" class="social-icon me-2"><i class="fab fa-twitter"></i></a>
                        <a href="#" class="social-icon me-2"><i class="fab fa-instagram"></i></a>
                        <a href="#" class="social-icon"><i class="fab fa-linkedin-in"></i></a>
                    </div>
                </div>
                <div class="col-lg-2 col-md-6">
                    <h5>Liên Kết Nhanh</h5>
                    <ul class="list-unstyled mt-3">
                        <li class="mb-2"><a href="{{ url_for('index') }}"><i class="fas fa-chevron-right me-2 text-primary"></i>Trang Chủ</a></li>
                        <li class="mb-2"><a href="{{ url_for('search') }}"><i class="fas fa-chevron-right me-2 text-primary"></i>Tìm Kiếm</a></li>
                        {% if user.is_authenticated %}
                            <li class="mb-2"><a href="{{ url_for('profile') }}"><i class="fas fa-chevron-right me-2 text-primary"></i>Hồ Sơ</a></li>
                            {% if user.user_type == 'landlord' %}
                                <li class="mb-2"><a href="{{ url_for('landlord_dashboard') }}"><i class="fas fa-chevron-right me-2 text-primary"></i>Bảng Điều Khiển</a></li>
                            {% endif %}
                            {% if user.user_type == 'admin' %}
                                <li class="mb-2"><a href="{{ url_for('admin_dashboard') }}"><i class="fas fa-chevron-right me-2 text-primary"></i>Quản Trị Hệ Thống</a></li>
                            {% endif %}
                        {% else %}
                            <li class="mb-2"><a href="{{ url_for('replit_auth.login') }}"><i class="fas fa-chevron-right me-2 text-primary"></i>Đăng Nhập</a></li>
                        {% endif %}
                    </ul>
                </div>
                <div class="col-lg-3 col-md-6">
                    <h5>Loại Bất Động Sản</h5>
                    <ul class="list-unstyled mt-3">
                        <li class="mb-2"><a href="{{ url_for('search', property_type='apartment') }}"><i class="fas fa-building me-2 text-primary"></i>Căn Hộ</a></li>
                        <li class="mb-2"><a href="{{ url_for('search', property_type='house') }}"><i class="fas fa-home me-2 text-primary"></i>Nhà</a></li>
                        <li class="mb-2"><a href="{{ url_for('search', property_type='room') }}"><i class="fas fa-door-open me-2 text-primary"></i>Phòng Trọ</a></li>
                        <li class="mb-2"><a href="{{ url_for('search', property_type='studio') }}"><i class="fas fa-laptop-house me-2 text-primary"></i>Căn Hộ Studio</a></li>
                    </ul>
                </div>
                <div class="col-lg-3 col-md-6">
                    <h5>Liên Hệ</h5>
                    <ul class="list-unstyled contact-info mt-3">
                        <li class="d-flex mb-3">
                            <i class="fas fa-envelope mt-1 me-3"></i>
                            <div>
                                <span>Email:</span>
                                <p class="mb-0">info@bienhoarentals.com</p>
                            </div>
                        </li>
                        <li class="d-flex mb-3">
                            <i class="fas fa-phone-alt mt-1 me-3"></i>
                            <div>
                                <span>Điện thoại:</span>
                                <p class="mb-0">+84 123 456 789</p>
                            </div>
                        </li>
                        <li class="d-flex mb-3">
                            <i class="fas fa-map-marker-alt mt-1 me-3"></i>
                            <div>
                                <span>Địa chỉ:</span>
                                <p class="mb-0">75 Võ Thị Sáu, P. Quyết Thắng,<br>Biên Hòa, Đồng Nai, Việt Nam</p>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="footer-bottom py-3">
            <div class="container">
                <div class="row">
                    <div class="col-md-6">
                        <p class="mb-0">&copy; 2025 BienHoa Rentals. Tất cả quyền được bảo lưu.</p>
                    </div>
                    <div class="col-md-6 text-md-end">
                        <p class="mb-0">Thiết kế và phát triển bởi <a href="#" class="text-primary">BienHoa Dev Team</a></p>
                    </div>
                </div>
            </div>
        </div>
    </footer>

    <!-- Enhanced AI Chat Widget -->
    <div class="chat-widget">
        <div class="chat-button" id="chat-button">
            <i class="fas fa-robot fa-lg"></i>
        </div>
        <div class="chat-window shadow-lg" id="chat-window" style="display: none;">
            <div class="chat-header">
                <div class="d-flex align-items-center">
                    <i class="fas fa-robot me-2"></i>
                    <h5 class="mb-0">Trợ Lý AI Tìm Nhà</h5>
                </div>
                <button class="close-chat" id="close-chat">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="chat-messages" id="chat-messages">
                <!-- Initial greeting message will be added by JS -->
            </div>
            <form class="chat-input" id="chat-form">
                <input type="text" id="chat-input" placeholder="Hỏi về nhà thuê ở Biên Hòa..." class="shadow-sm">
                <button type="submit" title="Gửi tin nhắn">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </form>
        </div>
    </div>

    <!-- Bootstrap JS Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Sortable.js for drag and drop functionality -->
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
    
    <!-- Custom JavaScript -->
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
    <script src="{{ url_for('static', filename='js/chat.js') }}"></script>
    
    {% block extra_js %}{% endblock %}
</body>
</html>

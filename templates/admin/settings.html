{% extends 'layout.html' %}

{% block title %}Cài Đặt Hệ Thống - Admin BienHoa Rentals{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <div class="row">
        <div class="col-md-2">
            <div class="card border-0 shadow-sm mb-4">
                <div class="card-header bg-dark text-white">
                    <h5 class="mb-0">Quản Trị</h5>
                </div>
                <div class="list-group list-group-flush">
                    <a href="{{ url_for('admin_dashboard') }}" class="list-group-item list-group-item-action {% if active_tab == 'dashboard' %}active{% endif %}">
                        <i class="fas fa-tachometer-alt me-2"></i> Tổng Quan
                    </a>
                    <a href="{{ url_for('admin_properties') }}" class="list-group-item list-group-item-action {% if active_tab == 'properties' %}active{% endif %}">
                        <i class="fas fa-home me-2"></i> Quản Lý Nhà
                    </a>
                    <a href="{{ url_for('admin_users') }}" class="list-group-item list-group-item-action {% if active_tab == 'users' %}active{% endif %}">
                        <i class="fas fa-users me-2"></i> Quản Lý Người Dùng
                    </a>
                    <a href="{{ url_for('admin_reviews') }}" class="list-group-item list-group-item-action {% if active_tab == 'reviews' %}active{% endif %}">
                        <i class="fas fa-star me-2"></i> Đánh Giá
                    </a>
                    <a href="{{ url_for('admin_settings') }}" class="list-group-item list-group-item-action {% if active_tab == 'settings' %}active{% endif %}">
                        <i class="fas fa-cog me-2"></i> Cài Đặt Hệ Thống
                    </a>
                </div>
            </div>
        </div>
        
        <div class="col-md-10">
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-white">
                    <h4 class="mb-0">Cài Đặt Hệ Thống</h4>
                </div>
                <div class="card-body">
                    <!-- Settings Tabs -->
                    <ul class="nav nav-tabs" id="settingsTabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="general-tab" data-bs-toggle="tab" data-bs-target="#general" type="button" role="tab" aria-controls="general" aria-selected="true">
                                <i class="fas fa-cog me-2"></i> Tổng Quan
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="appearance-tab" data-bs-toggle="tab" data-bs-target="#appearance" type="button" role="tab" aria-controls="appearance" aria-selected="false">
                                <i class="fas fa-paint-brush me-2"></i> Giao Diện
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="advanced-tab" data-bs-toggle="tab" data-bs-target="#advanced" type="button" role="tab" aria-controls="advanced" aria-selected="false">
                                <i class="fas fa-tools me-2"></i> Nâng Cao
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="backup-tab" data-bs-toggle="tab" data-bs-target="#backup" type="button" role="tab" aria-controls="backup" aria-selected="false">
                                <i class="fas fa-database me-2"></i> Sao Lưu & Phục Hồi
                            </button>
                        </li>
                    </ul>
                    
                    <div class="tab-content mt-4" id="settingsTabContent">
                        <!-- General Settings -->
                        <div class="tab-pane fade show active" id="general" role="tabpanel" aria-labelledby="general-tab">
                            <form action="{{ url_for('admin_settings_update') }}" method="POST" id="generalSettingsForm">
                                <input type="hidden" name="settings_type" value="general">
                                
                                <div class="card mb-4">
                                    <div class="card-header">
                                        <h5 class="mb-0">Thông Tin Trang Web</h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="row mb-3">
                                            <div class="col-md-6">
                                                <label for="siteName" class="form-label">Tên Trang Web</label>
                                                <input type="text" class="form-control" id="siteName" name="site_name" value="{{ settings.get('site_name', 'BienHoa Rentals') }}">
                                                <div class="form-text">Tên hiển thị của trang web.</div>
                                            </div>
                                            <div class="col-md-6">
                                                <label for="siteTagline" class="form-label">Khẩu Hiệu</label>
                                                <input type="text" class="form-control" id="siteTagline" name="site_tagline" value="{{ settings.get('site_tagline', 'Tìm nhà dễ dàng tại Biên Hòa') }}">
                                                <div class="form-text">Mô tả ngắn về trang web.</div>
                                            </div>
                                        </div>
                                        
                                        <div class="row mb-3">
                                            <div class="col-md-6">
                                                <label for="contactEmail" class="form-label">Email Liên Hệ</label>
                                                <input type="email" class="form-control" id="contactEmail" name="contact_email" value="{{ settings.get('contact_email', 'contact@bienhoarentals.com') }}">
                                                <div class="form-text">Email hiển thị cho người dùng liên hệ.</div>
                                            </div>
                                            <div class="col-md-6">
                                                <label for="contactPhone" class="form-label">Số Điện Thoại Liên Hệ</label>
                                                <input type="text" class="form-control" id="contactPhone" name="contact_phone" value="{{ settings.get('contact_phone', '0123 456 789') }}">
                                                <div class="form-text">Số điện thoại hiển thị cho người dùng liên hệ.</div>
                                            </div>
                                        </div>
                                        
                                        <div class="mb-3">
                                            <label for="siteDescription" class="form-label">Mô Tả Trang Web</label>
                                            <textarea class="form-control" id="siteDescription" name="site_description" rows="3">{{ settings.get('site_description', 'BienHoa Rentals cung cấp dịch vụ tìm kiếm và cho thuê bất động sản tại Biên Hòa, Đồng Nai.') }}</textarea>
                                            <div class="form-text">Mô tả chi tiết về trang web, được sử dụng cho SEO.</div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="card mb-4">
                                    <div class="card-header">
                                        <h5 class="mb-0">Cài Đặt Địa Phương</h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="row mb-3">
                                            <div class="col-md-6">
                                                <label for="defaultCity" class="form-label">Thành Phố Mặc Định</label>
                                                <input type="text" class="form-control" id="defaultCity" name="default_city" value="{{ settings.get('default_city', 'Biên Hòa') }}">
                                            </div>
                                            <div class="col-md-6">
                                                <label for="defaultProvince" class="form-label">Tỉnh Mặc Định</label>
                                                <input type="text" class="form-control" id="defaultProvince" name="default_province" value="{{ settings.get('default_province', 'Đồng Nai') }}">
                                            </div>
                                        </div>
                                        
                                        <div class="row">
                                            <div class="col-md-6">
                                                <label for="defaultCountry" class="form-label">Quốc Gia Mặc Định</label>
                                                <input type="text" class="form-control" id="defaultCountry" name="default_country" value="{{ settings.get('default_country', 'Việt Nam') }}">
                                            </div>
                                            <div class="col-md-6">
                                                <label for="currency" class="form-label">Đơn Vị Tiền Tệ</label>
                                                <select class="form-select" id="currency" name="currency">
                                                    <option value="VND" {% if settings.get('currency') == 'VND' %}selected{% endif %}>VND (Việt Nam Đồng)</option>
                                                    <option value="USD" {% if settings.get('currency') == 'USD' %}selected{% endif %}>USD (Đô la Mỹ)</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="card mb-4">
                                    <div class="card-header">
                                        <h5 class="mb-0">Mạng Xã Hội</h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="row mb-3">
                                            <div class="col-md-6">
                                                <label for="facebookUrl" class="form-label">Facebook URL</label>
                                                <div class="input-group">
                                                    <span class="input-group-text"><i class="fab fa-facebook-f"></i></span>
                                                    <input type="text" class="form-control" id="facebookUrl" name="facebook_url" value="{{ settings.get('facebook_url', '') }}">
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <label for="youtubeUrl" class="form-label">YouTube URL</label>
                                                <div class="input-group">
                                                    <span class="input-group-text"><i class="fab fa-youtube"></i></span>
                                                    <input type="text" class="form-control" id="youtubeUrl" name="youtube_url" value="{{ settings.get('youtube_url', '') }}">
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div class="row">
                                            <div class="col-md-6">
                                                <label for="twitterUrl" class="form-label">Twitter URL</label>
                                                <div class="input-group">
                                                    <span class="input-group-text"><i class="fab fa-twitter"></i></span>
                                                    <input type="text" class="form-control" id="twitterUrl" name="twitter_url" value="{{ settings.get('twitter_url', '') }}">
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <label for="instagramUrl" class="form-label">Instagram URL</label>
                                                <div class="input-group">
                                                    <span class="input-group-text"><i class="fab fa-instagram"></i></span>
                                                    <input type="text" class="form-control" id="instagramUrl" name="instagram_url" value="{{ settings.get('instagram_url', '') }}">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="text-end">
                                    <button type="submit" class="btn btn-primary">
                                        <i class="fas fa-save me-2"></i> Lưu Cài Đặt
                                    </button>
                                </div>
                            </form>
                        </div>
                        
                        <!-- Appearance Settings -->
                        <div class="tab-pane fade" id="appearance" role="tabpanel" aria-labelledby="appearance-tab">
                            <form action="{{ url_for('admin_settings_update') }}" method="POST" enctype="multipart/form-data" id="appearanceSettingsForm">
                                <input type="hidden" name="settings_type" value="appearance">
                                
                                <div class="card mb-4">
                                    <div class="card-header">
                                        <h5 class="mb-0">Hình Ảnh & Logo</h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="mb-3">
                                                    <label for="siteLogo" class="form-label">Logo Trang Web</label>
                                                    <input class="form-control" type="file" id="siteLogo" name="site_logo">
                                                    <div class="form-text">Kích thước đề xuất: 200x50 px. Tải lên nếu muốn thay đổi.</div>
                                                    {% if settings.get('site_logo') %}
                                                    <div class="mt-2">
                                                        <img src="{{ settings.get('site_logo') }}" alt="Site Logo" height="50" class="border p-1">
                                                    </div>
                                                    {% endif %}
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="mb-3">
                                                    <label for="favicon" class="form-label">Favicon</label>
                                                    <input class="form-control" type="file" id="favicon" name="favicon">
                                                    <div class="form-text">Kích thước đề xuất: 32x32 px. Tải lên nếu muốn thay đổi.</div>
                                                    {% if settings.get('favicon') %}
                                                    <div class="mt-2">
                                                        <img src="{{ settings.get('favicon') }}" alt="Favicon" height="32" class="border p-1">
                                                    </div>
                                                    {% endif %}
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div class="mb-3">
                                            <label for="heroImage" class="form-label">Ảnh Trang Chủ</label>
                                            <input class="form-control" type="file" id="heroImage" name="hero_image">
                                            <div class="form-text">Ảnh nền trang chủ. Kích thước đề xuất: 1920x600 px.</div>
                                            {% if settings.get('hero_image') %}
                                            <div class="mt-2">
                                                <img src="{{ settings.get('hero_image') }}" alt="Hero Image" height="100" class="border p-1">
                                            </div>
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="card mb-4">
                                    <div class="card-header">
                                        <h5 class="mb-0">Giao Diện</h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="row mb-3">
                                            <div class="col-md-6">
                                                <label for="primaryColor" class="form-label">Màu Sắc Chính</label>
                                                <div class="input-group">
                                                    <span class="input-group-text">
                                                        <input type="color" class="form-control form-control-color p-0 border-0" id="primaryColorPicker" value="{{ settings.get('primary_color', '#FF5A5F') }}" onchange="document.getElementById('primaryColor').value = this.value">
                                                    </span>
                                                    <input type="text" class="form-control" id="primaryColor" name="primary_color" value="{{ settings.get('primary_color', '#FF5A5F') }}" onchange="document.getElementById('primaryColorPicker').value = this.value">
                                                </div>
                                                <div class="form-text">Màu sắc chính của trang web (nút, tiêu đề, v.v.).</div>
                                            </div>
                                            <div class="col-md-6">
                                                <label for="secondaryColor" class="form-label">Màu Sắc Phụ</label>
                                                <div class="input-group">
                                                    <span class="input-group-text">
                                                        <input type="color" class="form-control form-control-color p-0 border-0" id="secondaryColorPicker" value="{{ settings.get('secondary_color', '#00A699') }}" onchange="document.getElementById('secondaryColor').value = this.value">
                                                    </span>
                                                    <input type="text" class="form-control" id="secondaryColor" name="secondary_color" value="{{ settings.get('secondary_color', '#00A699') }}" onchange="document.getElementById('secondaryColorPicker').value = this.value">
                                                </div>
                                                <div class="form-text">Màu sắc phụ của trang web.</div>
                                            </div>
                                        </div>
                                        
                                        <div class="row">
                                            <div class="col-md-6">
                                                <label for="fontFamily" class="form-label">Font Chữ</label>
                                                <select class="form-select" id="fontFamily" name="font_family">
                                                    <option value="system" {% if settings.get('font_family') == 'system' %}selected{% endif %}>Mặc Định Hệ Thống</option>
                                                    <option value="roboto" {% if settings.get('font_family') == 'roboto' %}selected{% endif %}>Roboto</option>
                                                    <option value="opensans" {% if settings.get('font_family') == 'opensans' %}selected{% endif %}>Open Sans</option>
                                                    <option value="montserrat" {% if settings.get('font_family') == 'montserrat' %}selected{% endif %}>Montserrat</option>
                                                </select>
                                                <div class="form-text">Font chữ cho trang web.</div>
                                            </div>
                                            <div class="col-md-6">
                                                <label for="theme" class="form-label">Chủ Đề</label>
                                                <select class="form-select" id="theme" name="theme">
                                                    <option value="light" {% if settings.get('theme') == 'light' %}selected{% endif %}>Sáng (Mặc Định)</option>
                                                    <option value="dark" {% if settings.get('theme') == 'dark' %}selected{% endif %}>Tối</option>
                                                </select>
                                                <div class="form-text">Chủ đề màu sắc chung của trang web.</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="text-end">
                                    <button type="submit" class="btn btn-primary">
                                        <i class="fas fa-save me-2"></i> Lưu Cài Đặt
                                    </button>
                                </div>
                            </form>
                        </div>
                        
                        <!-- Advanced Settings -->
                        <div class="tab-pane fade" id="advanced" role="tabpanel" aria-labelledby="advanced-tab">
                            <form action="{{ url_for('admin_settings_update') }}" method="POST" id="advancedSettingsForm">
                                <input type="hidden" name="settings_type" value="advanced">
                                
                                <div class="card mb-4">
                                    <div class="card-header">
                                        <h5 class="mb-0">Cài Đặt API</h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="mb-3">
                                            <label for="googleMapsApiKey" class="form-label">Google Maps API Key</label>
                                            <input type="text" class="form-control" id="googleMapsApiKey" name="google_maps_api_key" value="{{ settings.get('google_maps_api_key', '') }}">
                                            <div class="form-text">Sử dụng cho bản đồ và địa chỉ.</div>
                                        </div>
                                        
                                        <div class="row">
                                            <div class="col-md-6">
                                                <label for="openaiApiKey" class="form-label">OpenAI API Key</label>
                                                <input type="text" class="form-control" id="openaiApiKey" name="openai_api_key" value="{{ settings.get('openai_api_key', '') }}">
                                                <div class="form-text">Sử dụng cho trợ lý AI.</div>
                                            </div>
                                            <div class="col-md-6">
                                                <label for="aiModel" class="form-label">Model AI</label>
                                                <select class="form-select" id="aiModel" name="ai_model">
                                                    <option value="gpt-4" {% if settings.get('ai_model') == 'gpt-4' %}selected{% endif %}>GPT-4</option>
                                                    <option value="gpt-3.5-turbo" {% if settings.get('ai_model') == 'gpt-3.5-turbo' %}selected{% endif %}>GPT-3.5 Turbo</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="card mb-4">
                                    <div class="card-header">
                                        <h5 class="mb-0">Cài Đặt Lưu Trữ</h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="mb-3">
                                            <label for="uploadPath" class="form-label">Đường Dẫn Tải Lên</label>
                                            <input type="text" class="form-control" id="uploadPath" name="upload_path" value="{{ settings.get('upload_path', 'static/uploads/') }}">
                                            <div class="form-text">Đường dẫn tương đối để lưu tệp tải lên. Kết thúc bằng dấu '/'.</div>
                                        </div>
                                        
                                        <div class="row">
                                            <div class="col-md-6">
                                                <label for="maxUploadSize" class="form-label">Kích Thước Tải Lên Tối Đa (MB)</label>
                                                <input type="number" class="form-control" id="maxUploadSize" name="max_upload_size" min="1" max="50" value="{{ settings.get('max_upload_size', 10) }}">
                                            </div>
                                            <div class="col-md-6">
                                                <label for="imageSizing" class="form-label">Xử Lý Hình Ảnh</label>
                                                <select class="form-select" id="imageSizing" name="image_sizing">
                                                    <option value="resize" {% if settings.get('image_sizing') == 'resize' %}selected{% endif %}>Tự Động Chỉnh Kích Thước</option>
                                                    <option value="original" {% if settings.get('image_sizing') == 'original' %}selected{% endif %}>Giữ Kích Thước Gốc</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="card mb-4">
                                    <div class="card-header">
                                        <h5 class="mb-0">Cài Đặt Bảo Mật</h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="form-check form-switch mb-3">
                                            <input class="form-check-input" type="checkbox" id="enableRecaptcha" name="enable_recaptcha" value="1" {% if settings.get('enable_recaptcha') %}checked{% endif %}>
                                            <label class="form-check-label" for="enableRecaptcha">Bật Google reCAPTCHA</label>
                                            <div class="form-text">Bảo vệ biểu mẫu khỏi bot.</div>
                                        </div>
                                        
                                        <div class="row mb-3">
                                            <div class="col-md-6">
                                                <label for="recaptchaSiteKey" class="form-label">reCAPTCHA Site Key</label>
                                                <input type="text" class="form-control" id="recaptchaSiteKey" name="recaptcha_site_key" value="{{ settings.get('recaptcha_site_key', '') }}">
                                            </div>
                                            <div class="col-md-6">
                                                <label for="recaptchaSecretKey" class="form-label">reCAPTCHA Secret Key</label>
                                                <input type="text" class="form-control" id="recaptchaSecretKey" name="recaptcha_secret_key" value="{{ settings.get('recaptcha_secret_key', '') }}">
                                            </div>
                                        </div>
                                        
                                        <div class="form-check form-switch">
                                            <input class="form-check-input" type="checkbox" id="enableMaintenance" name="enable_maintenance" value="1" {% if settings.get('enable_maintenance') %}checked{% endif %}>
                                            <label class="form-check-label" for="enableMaintenance">Bật Chế Độ Bảo Trì</label>
                                            <div class="form-text">Hiển thị trang bảo trì cho người dùng không phải admin.</div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="text-end">
                                    <button type="submit" class="btn btn-primary">
                                        <i class="fas fa-save me-2"></i> Lưu Cài Đặt
                                    </button>
                                </div>
                            </form>
                        </div>
                        
                        <!-- Backup & Restore -->
                        <div class="tab-pane fade" id="backup" role="tabpanel" aria-labelledby="backup-tab">
                            <div class="card mb-4">
                                <div class="card-header">
                                    <h5 class="mb-0">Sao Lưu Dữ Liệu</h5>
                                </div>
                                <div class="card-body">
                                    <p>Tạo bản sao lưu của cơ sở dữ liệu và tải xuống.</p>
                                    
                                    <form action="{{ url_for('admin_database_backup') }}" method="POST">
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="form-check mb-3">
                                                    <input class="form-check-input" type="checkbox" value="1" id="includeImages" name="include_images" checked>
                                                    <label class="form-check-label" for="includeImages">
                                                        Bao gồm hình ảnh và tệp tải lên
                                                    </label>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <button type="submit" class="btn btn-primary">
                                                    <i class="fas fa-download me-2"></i> Tạo & Tải Bản Sao Lưu
                                                </button>
                                            </div>
                                        </div>
                                    </form>
                                    
                                    <hr>
                                    
                                    <h6>Lịch Sử Sao Lưu</h6>
                                    {% if backups %}
                                    <div class="table-responsive">
                                        <table class="table table-hover">
                                            <thead>
                                                <tr>
                                                    <th>Tên Tệp</th>
                                                    <th>Kích Thước</th>
                                                    <th>Ngày Tạo</th>
                                                    <th>Thao Tác</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {% for backup in backups %}
                                                <tr>
                                                    <td>{{ backup.filename }}</td>
                                                    <td>{{ backup.size }}</td>
                                                    <td>{{ backup.created_at }}</td>
                                                    <td>
                                                        <div class="btn-group btn-group-sm">
                                                            <a href="{{ url_for('admin_database_download', filename=backup.filename) }}" class="btn btn-outline-primary">Tải Xuống</a>
                                                            <button type="button" class="btn btn-outline-danger delete-backup-btn" data-filename="{{ backup.filename }}">Xóa</button>
                                                        </div>
                                                    </td>
                                                </tr>
                                                {% endfor %}
                                            </tbody>
                                        </table>
                                    </div>
                                    {% else %}
                                    <p class="text-muted">Chưa có bản sao lưu nào.</p>
                                    {% endif %}
                                </div>
                            </div>
                            
                            <div class="card mb-4">
                                <div class="card-header">
                                    <h5 class="mb-0">Phục Hồi Dữ Liệu</h5>
                                </div>
                                <div class="card-body">
                                    <div class="alert alert-warning">
                                        <i class="fas fa-exclamation-triangle me-2"></i> <strong>Cảnh báo:</strong> Phục hồi dữ liệu sẽ ghi đè lên toàn bộ dữ liệu hiện tại. Hãy sao lưu trước khi tiếp tục.
                                    </div>
                                    
                                    <form action="{{ url_for('admin_database_restore') }}" method="POST" enctype="multipart/form-data">
                                        <div class="mb-3">
                                            <label for="restoreFile" class="form-label">Tải Lên Tệp Sao Lưu</label>
                                            <input class="form-control" type="file" id="restoreFile" name="restore_file" accept=".zip">
                                            <div class="form-text">Chỉ chấp nhận tệp ZIP được tạo bởi hệ thống này.</div>
                                        </div>
                                        
                                        <div class="form-check mb-3">
                                            <input class="form-check-input" type="checkbox" value="1" id="confirmRestore" name="confirm_restore" required>
                                            <label class="form-check-label" for="confirmRestore">
                                                Tôi hiểu rằng dữ liệu hiện tại sẽ bị ghi đè.
                                            </label>
                                        </div>
                                        
                                        <button type="submit" class="btn btn-danger">
                                            <i class="fas fa-upload me-2"></i> Phục Hồi Dữ Liệu
                                        </button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Delete Backup Confirmation Modal -->
<div class="modal fade" id="deleteBackupModal" tabindex="-1" aria-labelledby="deleteBackupModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="deleteBackupModalLabel">Xác Nhận Xóa Bản Sao Lưu</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>Bạn có chắc chắn muốn xóa bản sao lưu này?</p>
                <p><strong>Tên tệp:</strong> <span id="backupFilenameToDelete"></span></p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                <form id="deleteBackupForm" action="{{ url_for('admin_database_delete_backup') }}" method="POST">
                    <input type="hidden" name="filename" id="backupFilenameInput">
                    <button type="submit" class="btn btn-danger">Xóa</button>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Tab persistence
    const triggerTabList = document.querySelectorAll('#settingsTabs button');
    
    // Check if there's a saved tab in localStorage
    const savedTab = localStorage.getItem('adminSettingsTab');
    if (savedTab) {
        const tabToActivate = document.querySelector(`#settingsTabs button[data-bs-target="${savedTab}"]`);
        if (tabToActivate) {
            const tab = new bootstrap.Tab(tabToActivate);
            tab.show();
        }
    }
    
    // Save active tab to localStorage when changed
    triggerTabList.forEach(triggerEl => {
        triggerEl.addEventListener('shown.bs.tab', function(event) {
            localStorage.setItem('adminSettingsTab', event.target.getAttribute('data-bs-target'));
        });
    });
    
    // Delete backup button handler
    const deleteBackupButtons = document.querySelectorAll('.delete-backup-btn');
    
    deleteBackupButtons.forEach(button => {
        button.addEventListener('click', function() {
            const filename = this.dataset.filename;
            
            document.getElementById('backupFilenameToDelete').textContent = filename;
            document.getElementById('backupFilenameInput').value = filename;
            
            new bootstrap.Modal(document.getElementById('deleteBackupModal')).show();
        });
    });
});
</script>
{% endblock %}